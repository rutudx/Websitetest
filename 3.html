<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arduino Python Controller</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }
    
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-bottom: 20px;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 768px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .panel h2 {
      color: #2d3748;
      margin-bottom: 16px;
      font-size: 1.4rem;
      font-weight: 600;
    }
    
    .connection-panel {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding: 16px;
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    
    button {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(79, 172, 254, 0.3);
    }
    
    button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
    }
    
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }
    
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ef4444;
      animation: pulse 2s infinite;
    }
    
    .status-dot.connected {
      background: #10b981;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .code-editor {
      position: relative;
      height: 400px;
      border-radius: 8px;
      overflow: hidden;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      background: #1a1a1a;
      border: 2px solid #333;
    }
    
    #codeEditor {
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      color: #f8f8f2;
      border: none;
      padding: 16px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
      resize: none;
      outline: none;
      tab-size: 4;
    }
    
    .editor-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 12px;
      gap: 12px;
    }
    
    .run-controls {
      display: flex;
      gap: 8px;
    }
    
    .quick-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .pin-control {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    input, select {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #4facfe;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
    }
    
    .console {
      background: #000;
      color: #00ff41;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
      height: 250px;
      overflow-y: auto;
      line-height: 1.4;
      border: 2px solid #333;
      white-space: pre-wrap;
    }
    
    .console::-webkit-scrollbar {
      width: 8px;
    }
    
    .console::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    
    .console::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }
    
    .example-scripts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    
    .example-btn {
      background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
      padding: 10px 16px;
      font-size: 13px;
    }
    
    .api-help {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid #3b82f6;
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .warning-banner {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ü§ñ Arduino Python Controller</h1>
      <p class="subtitle">Control your Arduino with Python-like code via Web Serial API</p>
    </header>

    <div class="warning-banner">
      ‚ö†Ô∏è Your Arduino must have StandardFirmata firmware flashed. This works in Chrome/Edge desktop only.
    </div>

    <div class="connection-panel">
      <button id="btnConnect">üîå Connect Arduino</button>
      <button id="btnDisconnect" class="btn-danger" disabled>‚ùå Disconnect</button>
      <div class="status-indicator">
        <div id="statusDot" class="status-dot"></div>
        <span id="status">Not connected</span>
      </div>
    </div>

    <div class="main-grid">
      <div class="panel">
        <div class="editor-header">
          <h2>üêç Python Code Editor</h2>
          <div class="run-controls">
            <button id="runCode" class="btn-success">‚ñ∂Ô∏è Run Code</button>
            <button id="stopCode" class="btn-danger">‚èπÔ∏è Stop</button>
          </div>
        </div>
        
        <div class="code-editor">
          <textarea id="codeEditor" placeholder="# Write your Python-like code here!
# Example:
arduino.pin_mode(13, OUTPUT)
arduino.digital_write(13, HIGH)
time.sleep(1)
arduino.digital_write(13, LOW)

# Available functions:
# arduino.pin_mode(pin, mode)  # INPUT, OUTPUT, PWM
# arduino.digital_write(pin, value)  # HIGH, LOW
# arduino.analog_write(pin, value)   # 0-255 for PWM
# time.sleep(seconds)
# print(message)

# Example blink:
for i in range(10):
    arduino.digital_write(13, HIGH)
    time.sleep(0.5)
    arduino.digital_write(13, LOW)
    time.sleep(0.5)
print('Blink complete!')"></textarea>
        </div>

        <div class="example-scripts">
          <button class="example-btn" data-example="blink">üí° LED Blink</button>
          <button class="example-btn" data-example="fade">üåÖ PWM Fade</button>
          <button class="example-btn" data-example="traffic">üö¶ Traffic Light</button>
          <button class="example-btn" data-example="knight">üöó Knight Rider</button>
        </div>

        <div class="api-help">
          <strong>üìö Python API:</strong><br>
          ‚Ä¢ <code>arduino.pin_mode(pin, mode)</code> - Set pin mode (INPUT, OUTPUT, PWM)<br>
          ‚Ä¢ <code>arduino.digital_write(pin, value)</code> - Write HIGH/LOW<br>
          ‚Ä¢ <code>arduino.analog_write(pin, value)</code> - PWM write (0-255)<br>
          ‚Ä¢ <code>time.sleep(seconds)</code> - Wait/delay<br>
          ‚Ä¢ <code>print(message)</code> - Output to console<br>
          ‚Ä¢ Constants: <code>HIGH, LOW, INPUT, OUTPUT, PWM</code>
        </div>
      </div>

      <div class="panel">
        <h2>üéõÔ∏è Manual Controls</h2>
        
        <div class="quick-controls">
          <button id="blinkBtn">üí° Blink Pin 13</button>
          <button id="readFirmware">üìã Read Firmware</button>
        </div>

        <div class="pin-control">
          <label>Pin:</label>
          <input id="pinNum" type="number" min="0" max="53" value="13" style="width:60px">
          <label>Mode:</label>
          <select id="pinMode">
            <option value="0">INPUT</option>
            <option value="1" selected>OUTPUT</option>
            <option value="3">PWM</option>
          </select>
          <button id="setMode">Set Mode</button>
        </div>

        <div class="pin-control">
          <button id="digitalLow">‚¨áÔ∏è LOW</button>
          <button id="digitalHigh">‚¨ÜÔ∏è HIGH</button>
          <label>PWM: <span id="pwmVal">0</span></label>
          <input id="pwmRange" type="range" min="0" max="255" value="0" style="flex:1">
          <button id="pwmWrite">Set PWM</button>
        </div>

        <h3>üìü Console Output</h3>
        <div id="console" class="console">Arduino Python Controller ready!
Connect your Arduino to start...
</div>
      </div>
    </div>
  </div>

  <script>
    // Firmata Lite Implementation
    const FirmataLite = (function(){
      const SET_PIN_MODE = 0xF4;
      const DIGITAL_MESSAGE = 0x90;
      const ANALOG_MESSAGE = 0xE0;
      const START_SYSEX = 0xF0;
      const END_SYSEX = 0xF7;
      const QUERY_FIRMWARE = 0x79;

      function toUint8Array(arr){
        return new Uint8Array(arr);
      }

      function setPinMode(pin, mode){
        return toUint8Array([SET_PIN_MODE, pin & 0x7F, mode & 0x7F]);
      }

      function digitalWrite(portStates, port){
        const lsb = portStates & 0x7F;
        const msb = (portStates >> 7) & 0x7F;
        return toUint8Array([DIGITAL_MESSAGE | (port & 0x0F), lsb, msb]);
      }

      function analogWrite(pin, value){
        const v = Math.max(0, Math.min(16383, value));
        const lsb = v & 0x7F;
        const msb = (v >> 7) & 0x7F;
        return toUint8Array([ANALOG_MESSAGE | (pin & 0x0F), lsb, msb]);
      }

      function requestFirmware(){
        return toUint8Array([START_SYSEX, QUERY_FIRMWARE, END_SYSEX]);
      }

      return { setPinMode, digitalWrite, analogWrite, requestFirmware };
    })();

    // Main Application
    let port = null;
    let writer = null;
    let reader = null;
    let keepReading = false;
    let portStates = {};
    let isRunning = false;
    let currentExecution = null;

    const consoleEl = document.getElementById('console');
    const statusEl = document.getElementById('status');
    const statusDot = document.getElementById('statusDot');

    function log(...args) {
      const timestamp = new Date().toLocaleTimeString();
      const message = args.map(a => 
        typeof a === 'object' ? JSON.stringify(a) : String(a)
      ).join(' ');
      consoleEl.textContent += `[${timestamp}] ${message}\n`;
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    function clearConsole() {
      consoleEl.textContent = '';
    }

    async function connect() {
      if (!('serial' in navigator)) {
        alert('‚ùå Web Serial API not supported. Use Chrome/Edge on desktop.');
        return;
      }
      
      try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 57600 });
        writer = port.writable.getWriter();
        startReadLoop();
        
        statusEl.textContent = 'Connected';
        statusDot.classList.add('connected');
        document.getElementById('btnDisconnect').disabled = false;
        document.getElementById('btnConnect').disabled = true;
        
        log('üü¢ Arduino connected successfully!');
      } catch (e) {
        log('‚ùå Connection failed:', e.message);
        alert('Failed to connect: ' + e.message);
      }
    }

    async function disconnect() {
      keepReading = false;
      isRunning = false;
      
      try {
        if (reader) { await reader.cancel(); reader = null; }
        if (writer) { writer.releaseLock(); writer = null; }
        if (port) { await port.close(); port = null; }
        
        statusEl.textContent = 'Not connected';
        statusDot.classList.remove('connected');
        document.getElementById('btnDisconnect').disabled = true;
        document.getElementById('btnConnect').disabled = false;
        
        log('üî¥ Arduino disconnected');
      } catch (e) {
        log('‚ö†Ô∏è Disconnect error:', e.message);
      }
    }

    async function startReadLoop() {
      if (!port) return;
      keepReading = true;
      
      try {
        const textDecoder = new TextDecoderStream();
        const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
        reader = textDecoder.readable.getReader();
        
        while (keepReading) {
          const { value, done } = await reader.read();
          if (done) break;
          if (value) {
            log('üì• Arduino:', value.replace(/\r/g,'').replace(/\n/g,''));
          }
        }
      } catch (e) {
        log('üì° Read loop ended:', e.message);
      }
    }

    async function writeBytes(arr) {
      if (!writer) {
        log('‚ùå Not connected - cannot send data');
        return;
      }
      try {
        await writer.write(arr);
        log('üì§ Sent:', Array.from(arr).map(x => '0x' + x.toString(16).padStart(2,'0')).join(' '));
      } catch (e) {
        log('‚ùå Write error:', e.message);
      }
    }

    // Python Interpreter
    class PythonArduino {
      pinMode(pin, mode) {
        const modeMap = { 'INPUT': 0, 'OUTPUT': 1, 'PWM': 3 };
        const modeNum = typeof mode === 'string' ? modeMap[mode] : mode;
        return writeBytes(FirmataLite.setPinMode(pin, modeNum));
      }

      digitalWrite(pin, value) {
        const port = pin >> 3;
        const mask = 1 << (pin & 0x7);
        const val = (typeof value === 'string' && value === 'HIGH') || value === 1 ? 1 : 0;
        
        if (val) {
          portStates[port] = (portStates[port] || 0) | mask;
        } else {
          portStates[port] = (portStates[port] || 0) & (~mask & 0xFF);
        }
        
        return writeBytes(FirmataLite.digitalWrite(portStates[port], port));
      }

      analogWrite(pin, value) {
        return writeBytes(FirmataLite.analogWrite(pin, Math.max(0, Math.min(255, value))));
      }
    }

    class PythonTime {
      sleep(seconds) {
        return new Promise(resolve => setTimeout(resolve, seconds * 1000));
      }
    }

    function createPythonEnvironment() {
      return {
        arduino: new PythonArduino(),
        time: new PythonTime(),
        HIGH: 'HIGH',
        LOW: 'LOW',
        INPUT: 'INPUT',
        OUTPUT: 'OUTPUT',
        PWM: 'PWM',
        print: (...args) => log('üêç', ...args),
        range: (n) => Array.from({length: n}, (_, i) => i),
        sleep: (seconds) => new Promise(resolve => setTimeout(resolve, seconds * 1000))
      };
    }

    // Improved Python-to-JS transpiler
    function transpilePythonToJS(code) {
      // Split into lines and process each
      const lines = code.split('\n');
      const result = [];
      const indentStack = [0];
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const trimmed = line.trim();
        
        // Skip empty lines and comments
        if (trimmed === '' || trimmed.startsWith('#')) {
          continue;
        }
        
        // Calculate current indentation level
        const indent = line.match(/^(\s*)/)[1].length;
        const currentLevel = Math.floor(indent / 4);
        
        // Handle indentation changes (close blocks)
        while (indentStack.length > 1 && currentLevel < indentStack[indentStack.length - 1]) {
          indentStack.pop();
          result.push('  '.repeat(indentStack.length - 1) + '}');
        }
        
        // Process the line
        let jsLine = trimmed;
        
        // Handle for loops
        if (jsLine.match(/^for\s+\w+\s+in\s+range\s*\(/)) {
          const match = jsLine.match(/^for\s+(\w+)\s+in\s+range\s*\((\d+)\)\s*:?/);
          if (match) {
            const [, varName, count] = match;
            jsLine = `for (let ${varName} = 0; ${varName} < ${count}; ${varName}++) {`;
            indentStack.push(currentLevel + 1);
          }
        }
        // Handle for loops with range(start, end)
        else if (jsLine.match(/^for\s+\w+\s+in\s+range\s*\(\d+,\s*\d+/)) {
          const match = jsLine.match(/^for\s+(\w+)\s+in\s+range\s*\((\d+),\s*(\d+)\)\s*:?/);
          if (match) {
            const [, varName, start, end] = match;
            jsLine = `for (let ${varName} = ${start}; ${varName} < ${end}; ${varName}++) {`;
            indentStack.push(currentLevel + 1);
          }
        }
        // Handle reversed range
        else if (jsLine.match(/^for\s+\w+\s+in\s+reversed\s*\(/)) {
          const match = jsLine.match(/^for\s+(\w+)\s+in\s+reversed\s*\((.+?)\)\s*:?/);
          if (match) {
            const [, varName, arrayExpr] = match;
            jsLine = `for (let ${varName} of ${arrayExpr}.slice().reverse()) {`;
            indentStack.push(currentLevel + 1);
          }
        }
        // Handle array iteration
        else if (jsLine.match(/^for\s+\w+\s+in\s+\w+\s*:?/)) {
          const match = jsLine.match(/^for\s+(\w+)\s+in\s+(\w+)\s*:?/);
          if (match) {
            const [, varName, arrayName] = match;
            jsLine = `for (let ${varName} of ${arrayName}) {`;
            indentStack.push(currentLevel + 1);
          }
        }
        // Handle if statements
        else if (jsLine.match(/^if\s+.+\s*:$/)) {
          jsLine = jsLine.replace(/:\s*$/, ' {');
          indentStack.push(currentLevel + 1);
        }
        // Handle else statements
        else if (jsLine === 'else:') {
          jsLine = '} else {';
          // Don't change indent stack as it's same level
        }
        // Replace Python function calls with JS equivalents
        else {
          jsLine = jsLine
            .replace(/arduino\.pin_mode/g, 'await arduino.pinMode')
            .replace(/arduino\.digital_write/g, 'await arduino.digitalWrite')
            .replace(/arduino\.analog_write/g, 'await arduino.analogWrite')
            .replace(/time\.sleep/g, 'await time.sleep')
            .replace(/^print\s*\(/g, 'print(');
        }
        
        // Add the processed line with proper indentation
        result.push('  '.repeat(indentStack.length - 1) + jsLine);
      }
      
      // Close any remaining blocks
      while (indentStack.length > 1) {
        indentStack.pop();
        result.push('  '.repeat(indentStack.length - 1) + '}');
      }
      
      return result.join('\n');
    }

    async function runPythonCode(code) {
      if (!writer) {
        log('‚ùå Please connect Arduino first!');
        return;
      }

      isRunning = true;
      const env = createPythonEnvironment();
      
      try {
        log('üöÄ Running Python code...');
        
        // Transpile Python to JavaScript
        const jsCode = transpilePythonToJS(code);
        
        // Debug: log the transpiled code
        console.log('Transpiled JS code:', jsCode);
        
        // Create execution context
        const asyncCode = `(async function() {
          const { arduino, time, HIGH, LOW, INPUT, OUTPUT, PWM, print, range } = arguments[0];
          ${jsCode}
        })`;
        
        const executionPromise = eval(asyncCode)(env);
        currentExecution = executionPromise;
        
        await executionPromise;
        log('‚úÖ Code execution completed!');
        
      } catch (error) {
        log('‚ùå Python execution error:', error.message);
        console.error('Full error:', error);
      } finally {
        isRunning = false;
        currentExecution = null;
      }
    }

    // Example scripts
    const examples = {
      blink: `# LED Blink Example
arduino.pin_mode(13, OUTPUT)
print("Starting LED blink...")

for i in range(10):
    arduino.digital_write(13, HIGH)
    time.sleep(0.5)
    arduino.digital_write(13, LOW)
    time.sleep(0.5)
    
print("Blink complete!")`,

      fade: `# PWM Fade Example  
arduino.pin_mode(9, PWM)
print("Starting PWM fade...")

for brightness in range(256):
    arduino.analog_write(9, brightness)
    time.sleep(0.01)
    
for brightness in range(255, 0):
    arduino.analog_write(9, brightness)
    time.sleep(0.01)
    
print("Fade complete!")`,

      traffic: `# Traffic Light Example
# Connect LEDs to pins 12, 11, 10 (Red, Yellow, Green)
arduino.pin_mode(12, OUTPUT)
arduino.pin_mode(11, OUTPUT)
arduino.pin_mode(10, OUTPUT)

print("Traffic light sequence starting...")

for cycle in range(5):
    arduino.digital_write(12, HIGH)
    arduino.digital_write(11, LOW)
    arduino.digital_write(10, LOW)
    time.sleep(3)
    
    arduino.digital_write(12, LOW)
    arduino.digital_write(11, HIGH)
    arduino.digital_write(10, LOW)
    time.sleep(1)
    
    arduino.digital_write(12, LOW)
    arduino.digital_write(11, LOW)
    arduino.digital_write(10, HIGH)
    time.sleep(3)
    
print("Traffic light complete!")`,

      knight: `# Knight Rider LED Effect
# Connect LEDs to pins 2-9
leds = [2, 3, 4, 5, 6, 7, 8, 9]

for pin in leds:
    arduino.pin_mode(pin, OUTPUT)
    arduino.digital_write(pin, LOW)

print("Knight Rider effect starting...")

for cycle in range(10):
    for pin in leds:
        arduino.digital_write(pin, HIGH)
        time.sleep(0.1)
        arduino.digital_write(pin, LOW)
        
    for pin in reversed(leds):
        arduino.digital_write(pin, HIGH)
        time.sleep(0.1)
        arduino.digital_write(pin, LOW)

print("Knight Rider complete!")`
    };

    // Event Listeners
    document.getElementById('btnConnect').addEventListener('click', connect);
    document.getElementById('btnDisconnect').addEventListener('click', disconnect);

    document.getElementById('runCode').addEventListener('click', async () => {
      const code = document.getElementById('codeEditor').value;
      await runPythonCode(code);
    });

    document.getElementById('stopCode').addEventListener('click', () => {
      isRunning = false;
      if (currentExecution) {
        log('‚èπÔ∏è Code execution stopped');
      }
    });

    // Manual controls
    document.getElementById('setMode').addEventListener('click', async () => {
      const pin = parseInt(document.getElementById('pinNum').value);
      const mode = parseInt(document.getElementById('pinMode').value);
      await writeBytes(FirmataLite.setPinMode(pin, mode));
      log(`üîß Set pin ${pin} to mode ${mode}`);
    });

    document.getElementById('digitalHigh').addEventListener('click', async () => {
      const pin = parseInt(document.getElementById('pinNum').value);
      const port = pin >> 3;
      const mask = 1 << (pin & 0x7);
      portStates[port] = (portStates[port] || 0) | mask;
      await writeBytes(FirmataLite.digitalWrite(portStates[port], port));
      log(`‚¨ÜÔ∏è Pin ${pin} HIGH`);
    });

    document.getElementById('digitalLow').addEventListener('click', async () => {
      const pin = parseInt(document.getElementById('pinNum').value);
      const port = pin >> 3;
      const mask = 1 << (pin & 0x7);
      portStates[port] = (portStates[port] || 0) & (~mask & 0xFF);
      await writeBytes(FirmataLite.digitalWrite(portStates[port], port));
      log(`‚¨áÔ∏è Pin ${pin} LOW`);
    });

    const pwmRange = document.getElementById('pwmRange');
    const pwmVal = document.getElementById('pwmVal');
    pwmRange.addEventListener('input', () => pwmVal.textContent = pwmRange.value);

    document.getElementById('pwmWrite').addEventListener('click', async () => {
      const pin = parseInt(document.getElementById('pinNum').value);
      const value = parseInt(pwmRange.value);
      await writeBytes(FirmataLite.analogWrite(pin, value));
      log(`üìä Pin ${pin} PWM: ${value}`);
    });

    document.getElementById('blinkBtn').addEventListener('click', async () => {
      const code = examples.blink;
      document.getElementById('codeEditor').value = code;
      await runPythonCode(code);
    });

    document.getElementById('readFirmware').addEventListener('click', async () => {
      await writeBytes(FirmataLite.requestFirmware());
      log('üìã Firmware info requested');
    });

    // Example script buttons
    document.querySelectorAll('.example-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const example = btn.dataset.example;
        document.getElementById('codeEditor').value = examples[example];
        log(`üìù Loaded ${example} example`);
      });
    });

    // Initialize
    log('üöÄ Arduino Python Controller loaded!');
    log('üí° Connect your Arduino with StandardFirmata to begin');
  </script>
</body>
</html>